function getSetting(){return"true"==localStorage.showdownbar}function downloadCreated(){chrome.downloads.setShelfEnabled(getSetting())}function downloadChanged(){chrome.downloads.search({},function(e){var o=!1,n=0;e.forEach(function(e){if("in_progress"==e.state)if(o=!0,n=++n,1===n){n=Math.round(100*e.bytesReceived/e.fileSize)+"%";var t=setInterval(downloadChanged(),5e3)}else clearInterval(t)}),getSetting()===!0&&o===!1&&chrome.downloads.setShelfEnabled(o),flashBadge(n)})}function flashBadge(e){0===e&&(e=""),chrome.browserAction.setBadgeBackgroundColor({color:"black"}),chrome.browserAction.setBadgeText({text:e.toString()})}chrome.downloads.onCreated.addListener(function(e){downloadCreated()}),chrome.downloads.onChanged.addListener(function(e){downloadChanged()}),chrome.runtime.onStartup.addListener(function(){console.log("Extension onStartup")}),chrome.runtime.onInstalled.addListener(function(){console.log("Extension Installed"),downloadChanged()}),chrome.runtime.onUpdateAvailable.addListener(function(){console.log("Extension Updated")}),chrome.browserAction.onClicked.addListener(function(e){var o="chrome://downloads/";chrome.tabs.query({currentWindow:!0},function(e){e.forEach(function(e){if(e.url==o)return chrome.tabs.update(e.id,{selected:!0}),o=!1,!1}),o!==!1&&chrome.tabs.create({url:o,selected:!0})})});